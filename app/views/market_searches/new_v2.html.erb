<div ng-app="marketSearches">
<div ng-controller="mktSearchController">

<h1>
  Market Share
</h1>

<div class="margin-20">
    Define the type of market that you want to analyze. EG) All computer sales in Alberta, or all products in Quebec, etc.
</div>

<form>

    <div class="row margin-20" ng-repeat="param in params track by $index">
        <div class="col-md-4 form-group">
            <label ng-if="$index == 0">Search by...</label>
            <select ng-model="param.property" class="form-control">
                <option ng-repeat="option in options" value="{{option.value}}">
                    {{option.display}}
                </option>
            </select>
        </div>
        <div class="col-md-4 form-group">
            <label ng-if="$index == 0">Search Term</label>
            <input class="form-control" ng-model="param.search_term">
        </div>
        <div class="col-md-4 form-group">
            <label ng-if="$index == 0">&nbsp;</label>
            <span class="btn btn-danger" ng-click="removeFilter()">
                Remove this filter
            </span>
        </div>
    </div>

    <div class="row margin-20">
        <div class="col-md-2 col-md-offset-8">
            <span class="btn btn-primary" ng-click="addFilter()">
                Add filter
            </span>
        </div>
        <div class="col-md-2">
            <span class="btn btn-success" ng-click="search()">
                Search
            </span>
        </div>
    </div>

</form>

<div class="margin-20">
    There are {{results.length}} results.
</div>

<div class="margin-20" ng-if="results.length > 0">
    <%= render partial: "pie_charts" %>
</div>

<div class="table-wrapper" ng-if="results.length > 0">
    <table id="results-table">
        <tr>
            <th>Company</th>
            <th>Priority Level</th>
            <th>Product</th>
            <th>Category</th>
            <th>Province</th>
            <th>Country</th>
            <th>Sales</th>
            <th>Description</th>
        </tr>    
        <tr ng-repeat="row in results">
            <td>{{row.company}}</td>
            <td>{{row.priority}}</td>
            <td>{{row.product}}</td>
            <td>{{row.category}}</td>
            <td>{{row.province}}</td>
            <td>{{row.country}}</td>
            <td class="cell-number">${{ insertCommas(row.sales) }}</td>
            <td>{{row.description}}</td>
        </tr>
    </table>
</div>

<!-- Close ng-app and ng-controller -->
</div>
</div>